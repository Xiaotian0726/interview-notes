- [0、事务](#0事务)
  - [定义](#定义)
  - [事务的四大特性 ACID](#事务的四大特性-acid)
  - [事务的隔离级别](#事务的隔离级别)
- [1、数据库索引](#1数据库索引)
- [2、范式](#2范式)
- [3、查询处理与优化](#3查询处理与优化)

# 0、事务
## 定义
是访问并可能操作各种数据项的一组数据库操作序列，这些操作要么全都执行，要么全都不执行。

一个典型的数据库事务：
```
BEGIN TRANSACTION
A 账户减少 100 元
B 账户增加 100 元
COMMIT or ROLLBACK
```

## 事务的四大特性 ACID
* 原子性（Atomicity）：事务中的所有操作作为一个整体像原子一样不可分割，要么全部成功,要么全部失败
* 一致性（Consistency）：事务的执行结果必须使数据库从一个一致性状态到另一个一致性状态。（一致性状态是指满足数据的完整性约束，如主键、参照完整性约束、check 约束等，并且系统的状态能反映数据库本应描述的现实世界的真实状态，比如转账前后两个账户的金额总和应该保持不变）
* 隔离性（Isolation）：隔离性针对的是并发执行的事务。隔离性是指并发执行的事务之间不会相互影响，其对数据库的影响和它们串行执行时一样。比如多个用户同时往一个账户转账，最后账户的结果应该和他们按先后次序转账的结果一样
* 持久性（Durability）：持续性也称永久性（Permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其执行结果有任何影响。

## 事务的隔离级别
...

# 1、数据库索引
* 聚簇索引：数据的物理组织是有序的，一个文件对应的聚簇索引是唯一的。索引和文件内容都是有序的。一个表最多只能有一个聚簇索引，因为物理存储只能有一个顺序，一个表设置什么为聚簇索引对性能很关键
* 非聚簇索引：叶子结点存放的是内容在文件中的位置，索引有序，但是文件内容无序。由于访问时需要访问不同的 Page 会有大量 I/O 调入 page 的操作，效率低于聚簇索引

# 2、范式
一些不好的关系模式存在的问题：
* 数据冗余
* 更新异常
* 插入异常
* 删除异常

设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小

* **1 NF**：如果关系模式 R 的每个关系 r 的属性值都是不可分的原子值，则称 R 满足 1 NF
* **2 NF**：如果关系模式 R 中的所有非主属性都完全函数依赖于所有 CK，则称 R 满足 2 NF。2 NF 是在 1 NF 的基础上消除非主属性对于所有候选键的部分函数依赖
* **3 NF**：如果关系模式 R 中的非主属性既不部分函数依赖也不传递函数依赖于 R 上的所有候选键，则称 R 满足 3 NF。3 NF 是在 2 NF 的基础上消除非主属性对于键的传递依赖
* **BCNF**：若对于 R 上的任何非平凡函数依赖 X→Y 都有 X 必包含 R 的某个候选键，则称 R 满足 BCNF
* **4 NF**：设 D 是关系模式 R 上成立的 FD 和 MVD 集合。如果 D 中每个非平凡的 MVD X→→Y 的左部 X 都是 R 的超键，那么称 R 满足 4 NF（即若存在多值依赖，则都是平凡的多值依赖）
* **5 NF**：完美范式

# 3、查询处理与优化
查询优化的途径：
* 代数优化：对查询语句进行等价变化，使查询执行起来更有效。例如把投影和选择操作放在连接操作之前
* 物理优化：选择合适的存取策略，例如是选择顺序扫描还是选择索引